using System;
using NUnit.Framework;
using System.Linq;
using System.Collections.Generic;
using Mpdeimos.GitRepoZipper.Scenario;

namespace Mpdeimos.GitRepoZipper.Model
{
	[TestFixture]
	public class ZippedBranchTest : RepoTestBase
	{
		static public IEnumerable<TestCaseData> TestCaseData
		{
			get
			{
				foreach (var scenario in ZipScenario.Scenarios)
				{
					foreach (var branch in scenario.Branches.Keys)
					{
						yield return new TestCaseData(scenario.Sources, branch)
							.Returns(scenario.Branches[branch])
							.SetName(string.Join("+", scenario.Sources) + ":" + branch);
					}
				}
			}
		}

		[Test, TestCaseSource(nameof(TestCaseData))]
		public string[] TestGetZippedBranch(string[] repos, string branch)
		{
			var zipped = new ZippedBranch(branch);
			foreach (string repo in repos)
			{
				var gitBranch = GetTestRepo(repo).Branches[branch];
				if (gitBranch != null)
				{
					zipped.AddBranch(gitBranch);
				}
			}

			return zipped.GetZippedBranch().Select(c => c.Sha).ToArray();
		}
	}
}

